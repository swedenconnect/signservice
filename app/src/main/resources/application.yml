#
# SignService configuration
#

server:
  port: 8443
  servlet:
    context-path: /
  ssl:
    enabled: true
    key-store: classpath:localhost.jks
    key-store-type: JKS
    key-alias: localhost
    key-store-password: secret
    key-password: secret

#
# Management
#
management:
  server:
    port: 8081
  auditevents:
    enabled: true
  endpoint:
    auditevents:
      enabled: true
  endpoints:
    web:
      exposure:
        include: health,info,auditevents

signservice:
  domain: localhost
  base-url: https://${signservice.domain}:${server.port}
  system-audit:
    actuator:
      name: "SignService System Audit Logger"
      principal: "SignService"
  default-sign-service-id: https://sandbox.swedenconnect.se/signservice
  default-credential:
    name: SignService
    resource: classpath:signservice.jks
    alias: signservice
    type: JKS
    password: secret
    key-password: secret
  default-handler-config:
    protocol:
      dss:
        name: "DssProtocolHandler"
        include-assertion: true
        include-request-message: true
    sign:
      default-handler:
        tbs-processors:
        - type: xml
          strict-processing: false
          include-issuer-serial: true
        - type: pdf
    cert:
      cmc:
        rsa-provider:
          key-size: 4096
#          stack-size: 10
        ec-provider:
          curve-name: P-256
        cmc-client-credential-props:
          resource: classpath:sandbox/cmc-client.jks
          alias: cmc
          password: secret
          key-password: secret
          type: JKS
        cmc-request-url: https://sandbox.swedenconnect.se/sigca/cmc/ca01
        cmc-responder-certificate: classpath:sandbox/cmc-responder.crt
        ca-certificate-type: PKC
        remote-ca-info:
          ca-certificate-chain:
          - classpath:sandbox/sandbox-ca.crt
          - classpath:sandbox/sandbox-root-ca.crt
          ca-algorithm: http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256
          crl-dp-urls:
          - https://sandbox.swedenconnect.se/sigca/crl/ca01.crl
          ocsp-responser-url: https://sandbox.swedenconnect.se/sigca/ocsp/ca01
        cmc-signing-algorithm: http://www.w3.org/2001/04/xmldsig-more#rsa-sha256
        default-value-policy-checker:
          default-reply: false
          rules:
          - attribute-type: rdn
            ref: "2.5.4.6"
            allowed-values:
            - SE
    authn:
      saml:
        saml-type: sweden-connect
        sp-paths:
          base-url: ${signservice.base-url}
        metadata-providers:
        - url: https://eid.svelegtest.se/metadata/mdx/role/idp.xml
          backup-file: ${SIGNSERVICE_HOME}/sandbox-metadata.xml
          validation-certificate: classpath:sandbox/sandbox-metadata.crt
        signature-credential-props:
          name: SignService SAML Signing
          resource: classpath:sandbox/saml-sp.jks
          alias: sign
          type: JKS
          password: secret
          key-password: secret
        decryption-credential-props:
          name: SignService SAML Decryption
          resource: classpath:sandbox/saml-sp.jks
          alias: encrypt
          type: JKS
          password: secret
          key-password: secret
        sign-authn-requests: true
        require-encrypted-assertions: true
        response-validation:
          strict-validation: false
          require-signed-assertions: true
          allowed-clock-skew: PT60S
        metadata:
          entity-categories:
          - http://id.elegnamnden.se/st/1.0/sigservice
          - http://id.elegnamnden.se/ec/1.0/loa3-pnr
          - http://id.swedenconnect.se/ec/sc/uncertified-loa3-pnr
          - http://id.elegnamnden.se/ec/1.0/eidas-naturalperson
          - http://id.elegnamnden.se/st/1.0/public-sector-sp
          - http://id.swedenconnect.se/contract/sc/sweden-connect
          - http://id.swedenconnect.se/contract/sc/eid-choice-2017
          - http://id.swedenconnect.se/general-ec/1.0/secure-authenticator-binding
          - http://id.swedenconnect.se/general-ec/1.0/accepts-coordination-number
          authn-requests-signed: true
          want-assertions-signed: true
          requested-attributes:
          - name: urn:oid:1.2.752.29.4.13
            required: false
          - name: urn:oid:1.2.752.201.3.4
            required: false
          service-names:
          - "sv-SignService Demo"
          - "en-SignService Demo"
          ui-info:
            display-names:
            - "sv-Sweden Connect Demo SignService"
            - "en-Sweden Connect Demo SignService"
            descriptions:
            - "sv-Sweden Connect Underskriftstjänst för test och demonstration"
            - "en-Sweden Connect SignService for test and demonstration"
            logos:
            - path: /images/logo.svg
              height: 56
              width: 280
            - path: /images/logo-notext.svg
              height: 256
              width: 256
          organization:
            names:
            - "sv-Sweden Connect"
            - "en-Sweden Connect"
            display-names:
            - "sv-Sweden Connect"
            - "en-Sweden Connect"
            urls:
            - "en-https://www.swedenconnect.se"
          contact-persons:
            support:
              company: "Sweden Connect"
              email-address: operations@swedenconnect.se
            technical:
              company: "Sweden Connect"
              email-address: operations@swedenconnect.se
  engines:
  - name: "localhost"
    sign-service-id: https://localhost.swedenconnect.se/signservice
    processing-paths:
    - /sign/localhost/eid2cssp
    client:
      client-id: https://eid2cssp.3xasecurity.com/sign
      trusted-certificates:
      - classpath:clients/eid2cssp.3xasecurity.com.crt
    protocol:
      dss:
        include-request-message: false
        default-config-ref: protocol.dss
    authn:
      saml:        
        default-config-ref: authn.saml
        entity-id: https://localhost.swedenconnect.se/eid2cssp
        sp-paths:
          metadata-publishing-path: /sign/localhost/eid2cssp/saml/metadata
          assertion-consumer-path: /sign/localhost/eid2cssp/saml/sso
        preferred-binding: POST
        metadata:
          ui-info:
            display-names:
            - "en-Sweden Connect Localhost Signature Service Test"
            - "sv-Sweden Connect test för underskriftstjänster (localhost)"
            descriptions:
            - "en-Sweden Connect test application for signature services running on localhost"
            - "sv-Sweden Connect testapplikation för underskriftstjänster (localhost)"
    sign:
      default-handler:
        default-config-ref: sign.default-handler
    cert:
      cmc:
        default-config-ref: cert.cmc
    audit:
      file:
        name: "Sandbox2 Audit Logger"
        file-name: ${SIGNSERVICE_HOME}/localhost/audit.log
  - name: "Sandbox SignService Test Application"
    processing-paths:
    - /sign/sandbox/eid2cssp
    client:
      client-id: https://eid2cssp.3xasecurity.com/sign
      trusted-certificates:
      - classpath:clients/eid2cssp.3xasecurity.com.crt
    protocol:
      dss:
        include-request-message: false
        default-config-ref: protocol.dss
    authn:
      saml:
        default-config-ref: authn.saml
        entity-id: https://sandbox.swedenconnect.se/eid2cssp
        sp-paths:
          metadata-publishing-path: /sign/sandbox/eid2cssp/saml/metadata
          assertion-consumer-path: /sign/sandbox/eid2cssp/saml/sso
        metadata:
          ui-info:
            display-names:
            - "en-Sweden Connect Signature Service Test"
            - "sv-Sweden Connect test för underskriftstjänster"
            descriptions:
            - "en-Sweden Connect test application for signature services"
            - "sv-Sweden Connect testapplikation för underskriftstjänster"
    sign:
      default-handler:
        default-config-ref: sign.default-handler
    cert:
      cmc:
        default-config-ref: cert.cmc
    audit:
      log-system:
        name: "Sandbox SignService Test Application Audit Logger"
        logger-name: SANDBOX_TEST_APP

  - name: "Sandbox2"
    processing-paths:
    - /sign/sandbox2
    client:
      client-id: https://eid2cssp.3xasecurity.com/sign2
      trusted-certificates:
      - classpath:clients/eid2cssp.3xasecurity.com.crt
    protocol:
      dss:
        include-request-message: false
        default-config-ref: protocol.dss
    authn:
      mock:
        active: true
    sign:
      external:
        bean-name: signservice.DefaultSignatureHandler
    cert:
      built-in-ca:
        base-url: ${signservice.base-url}
        ca-credential-props:
          resource: classpath:ca/test-ca.jks
          alias: test-ca
          type: JKS
          password: secret
          key-password: secret
        ca-signing-algorithm: http://www.w3.org/2001/04/xmldsig-more#ecdsa-sha256
        ca-certificate-type: PKC
        crl-dp-path: /sign/sandbox2/ca/testca.crl
        crl-file-location: ${SIGNSERVICE_HOME}/sandbox2/testca.crl
        rsa-provider:
          key-size: 4096
        ec-provider:
          curve-name: P-256
        default-value-policy-checker:
          default-reply: false
          rules:
          - attribute-type: rdn
            ref: "2.5.4.6"
            allowed-values:
            - SE
    audit:
      file:
        name: "Sandbox2 Audit Logger"
        file-name: ${SIGNSERVICE_HOME}/sandbox2/audit.log

#
# Logging
#
logging:
  level:
    se:
      swedenconnect:
        security: DEBUG
        signservice: DEBUG
#  file:
#    path: app/target/logs


#logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=DEBUG
